#!/usr/bin/env node

!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(12);(r=o)&&r.__esModule;var i=function(){};t.default={twoLinesDifferentColors:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blue",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"green";this.wrapInNewlines(function(){e.length>0&&console.log(e[n]),t.length>0&&console.log(t[r])})},singleLine:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.wrapInNewlines(function(){return console.log(e[t])},n)},success:function(e){this.wrapInNewlines(function(){return console.log(e.green)})},error:function(e){this.wrapInNewlines(function(){return console.log(e.red)})},progress:function(e){process.stdout.write(e)},wrapInNewlines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t-1>0?new Array(t-1).fill("\n").join(""):"";t>0&&console.log(n),e(),t>0&&console.log(n)}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("socket.io-client")},function(e,t){e.exports=require("socket.io-stream")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(1)),o=a(n(15)),i=a(n(16)),u=a(n(6));function a(e){return e&&e.__esModule?e:{default:e}}var s=new i.default({highlight:function(e,t){if(t&&o.default.getLanguage(t))try{return'<pre class="hljs"><code>'+o.default.highlight(t,e,!0).value+"</code></pre>"}catch(e){}return""}}),c=(0,u.default)(r.default.readFile);t.default={getFileName:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.lastIndexOf("."),r=e.substring(n);return e.substring(0,n)+"_"+t+r},expressjs:{convertReadmeToHtml:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c("README.md","utf8");case 2:return n=e.sent,r=s.render(n),e.abrupt("return",t.send(this.createHtmlPage(r)));case 5:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})});return function(e){return t.apply(this,arguments)}}(),createHtmlPage:function(e){return'\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n            <title>txr - Transfer Files to Friends</title>\n\n            <style>\n              body {\n                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n              }\n\n              a {\n                color: inherit;\n              }\n\n              pre.hljs {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #f5f5f5;\n                overflow-x: scroll;\n                padding: 5px;\n              }\n\n              .container {\n                max-width: 700px;\n                margin-right: auto;\n                margin-left: auto;\n              }\n\n              .notice {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #28a745;\n                color: white;\n                padding: 15px;\n                margin: 25px 0px;\n              }\n            </style>\n          </head>\n\n          <body>\n            <div class="container">\n              <div class="notice">\n                You navigated to a txr server to transfer files easily to and\n                from other machines. Learn more below or by visiting\n                <a href="https://www.npmjs.com/package/txr">https://www.npmjs.com/package/txr</a>\n              </div>\n              '+e+"\n            </div>\n          </body>\n        </html>\n      "}}}},function(e,t){e.exports=require("es6-promisify")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={filepath:process.env.TXR_PATH||process.env["win32"==process.platform?"USERPROFILE":"HOME"],server:{port:process.env.PORT||8e3,web_conc:process.env.WEB_CONCURRENCY||1,host:process.env.TXR_HOST||"https://txr.euphoritech.com"},logger:{options:{name:process.env.APP_NAME||"txr",level:process.env.LOGGING_LEVEL||"info",stream:process.stdout}}}},function(e,t,n){n(9),e.exports=n(10)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=a(n(11)),i=a(n(0)),u=a(n(13));function a(e){return e&&e.__esModule?e:{default:e}}var s=(0,o.default)(process.argv.slice(2)),c=r(s._,3),f=c[0],l=c[1],d=c[2];!function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,n,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.c||s.command||f,n=s.f||s.file||s.d||s.dir||l,r=s.u||s.username||d||l,o=s.a||s.auth,a=s.h||s.host,!t||!u.default[t]){e.next=10;break}return e.next=8,u.default[t]({file:n,user:r,auth:o,host:a});case 8:e.next=11;break;case 10:i.default.error("Please enter a valid command (-c or --command).");case 11:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})});return function(){return t.apply(this,arguments)}}()()},function(e,t){e.exports=require("minimist")},function(e,t){e.exports=require("colors")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(14)),o=i(n(19));function i(e){return e&&e.__esModule?e:{default:e}}t.default={listen:r.default,send:o.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(1)),o=l(n(2)),i=l(n(3)),u=l(n(4)),a=l(n(5)),s=l(n(17)),c=l(n(0)),f=l(n(7));function l(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})}}t.default=function(){var e=d(regeneratorRuntime.mark(function e(t){var n,l=this,p=(t.file,t.user),h=t.auth,v=t.host;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=2;break}return e.abrupt("return",c.default.error("Make sure you pass a user (-u or --username) to listen for files that could be sent to you.\n"));case 2:(n=i.default.connect(v||f.default.server.host)).emit("regiser-listen",{user:p,auth:h}),n.on("user-taken",function(){c.default.error("The user you chose, "+p+", is already registered with the server. Please try another username."),process.exit()}),n.on("user-registered-success",function(e){c.default.success("Successfully registered name: "+e+". You are now listening for files.")}),n.on("file-permission",function(){var e=d(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return delete t.user,e.next=3,(0,s.default)().ask("\nSomeone wants to send you a file. Are you okay receiving a file with this data: "+JSON.stringify(t)+" -- answer (yes/no): ");case 3:r=e.sent,c.default.success("You answered '"+r+"', we're letting the server and sender know now."),n.emit("file-permission-response",r);case 6:case"end":return e.stop()}},e,l)}));return function(t){return e.apply(this,arguments)}}()),n.on("disconnect",function(){c.default.error("You were disconnected from the server."),process.exit()}),(0,u.default)(n).on("file",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};delete t.user,c.default.success("Starting to receive file with data: "+JSON.stringify(t));var n=a.default.getFileName(t.filename||"txr.file"),i=o.default.join(f.default.filepath,o.default.basename(n)),u=r.default.createWriteStream(i);e.on("data",function(e){e.length,c.default.progress(".")}),e.on("error",function(e){return c.default.error("\nError reading stream: "+e.toString())}),e.on("end",function(){c.default.success("\nFinished receiving file with data: "+JSON.stringify(t)),c.default.success("Target file path: "+i)}),e.pipe(u)});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("highlight.js")},function(e,t){e.exports=require("markdown-it")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{rl:i.default.createInterface({input:process.stdin,output:process.stdout}),ask:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(r,o){t.rl.question(e,function(e){r(e),n&&t.close()})})},close:function(){this.rl.close()}}};var r,o=n(18),i=(r=o)&&r.__esModule?r:{default:r}},function(e,t){e.exports=require("readline")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(1)),o=d(n(2)),i=d(n(6)),u=d(n(3)),a=d(n(4)),s=d(n(20)),c=d(n(5)),f=d(n(0)),l=d(n(7));function d(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})}}var h=(0,i.default)(r.default.access),v=(0,i.default)(r.default.lstat),m=(0,i.default)(r.default.unlink),g=(0,i.default)(r.default.writeFile),x=(0,i.default)(s.default);t.default=function(){var e=p(regeneratorRuntime.mark(function e(t){var n,i,s,d,y,w,b,_,k,P,R,O,M,j,N,T=this,q=(n=p(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!P){e.next=3;break}return e.next=3,m(k);case 3:t(),process.exit();case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)}),S=t.file,E=t.user,A=t.host;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=E,i=S){e.next=4;break}return e.abrupt("return",f.default.error("Make sure you pass an absolute filepath (-f or --file) to send a file.\n"));case 4:if(s){e.next=6;break}return e.abrupt("return",f.default.error("Make sure you pass a user (-u or --username) to send a file to.\n"));case 6:return e.next=8,function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(i);case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,T,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()(i);case 8:if(e.sent){e.next=11;break}return e.abrupt("return",f.default.error("We couldn't find a file or directory located in the following location:\n"+i+"\n"));case 11:return e.next=13,v(i);case 13:if(d=e.sent,y=d.isDirectory(),w=d.isFile(),b=d.size,_=void 0,k=void 0,P=void 0,!y){e.next=28;break}return f.default.success("We are zipping and sending the directory: "+i+". This may take some time depending on how large the directory is..."),e.next=22,x(i);case 22:_=e.sent,k=c.default.getFileName(i+".zip"),P=!0,b+=" (directory)",e.next=34;break;case 28:if(!w){e.next=33;break}_=i,k=i,e.next=34;break;case 33:return e.abrupt("return",f.default.error("The path specified is not a file or directory. The specified path needs to be a file or directory.\n"+i+"\n"));case 34:if(R=u.default.connect(A||l.default.server.host),O=a.default.createStream(),M=o.default.basename(k),j={filename:M,filesizebytes:b,user:s},R.emit("send-file-check-auth",j),R.on("no-user",function(e){return q(function(){return f.default.error("No user registered with username: "+e.user)})}),R.on("file-permission-granted",function(){return(0,a.default)(R).emit("upload",O,j)}),R.on("file-permission-waiting",function(){return f.default.success("Waiting for user to grant or reject receiving the file.")}),R.on("file-permission-denied",function(){return q(function(){return f.default.error("User did not grant permission to send file.")})}),R.on("file-data-hash-mismatch",function(){return q(function(){return f.default.error("We can't validate the file you're sending.")})}),R.on("finished-uploading",function(){return q(function(){return f.default.success("Your file has successfully sent to "+s+"!")})}),R.on("disconnect",function(){return q(function(){return f.default.error("You were disconnected from the server.")})}),!(_ instanceof Buffer)){e.next=49;break}return e.next=49,g(k,_);case 49:N=r.default.createReadStream(k),0,N.on("data",function(e){e.length,f.default.progress(".")}),N.on("end",function(){return f.default.success("\nAll bytes have been read from file: "+k+".")}),N.pipe(O);case 54:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("zip-dir")}]);