#!/usr/bin/env node

!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e&&e.__esModule}(n(12));var r=function(){};t.default={twoLinesDifferentColors:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blue",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"green";this.wrapInNewlines(function(){e.length>0&&console.log(e[n]),t.length>0&&console.log(t[r])})},singleLine:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.wrapInNewlines(function(){return console.log(e[t])},n)},success:function(e){this.wrapInNewlines(function(){return console.log(e.green)})},error:function(e){this.wrapInNewlines(function(){return console.log(e.red)})},progress:function(e){process.stdout.write(e)},wrapInNewlines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t-1>0?new Array(t-1).fill("\n").join(""):"";t>0&&console.log(n),e(),t>0&&console.log(n)}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("socket.io-client")},function(e,t){e.exports=require("socket.io-stream")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}return r("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),u=r(n(15)),a=r(n(16)),s=r(n(6)),c=new a.default({highlight:function(e,t){if(t&&u.default.getLanguage(t))try{return'<pre class="hljs"><code>'+u.default.highlight(t,e,!0).value+"</code></pre>"}catch(e){}return""}}),f=(0,s.default)(i.default.readFile);t.default={getFileName:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.lastIndexOf("."),r=e.substring(n);return e.substring(0,n)+"_"+t+r},expressjs:{convertReadmeToHtml:function(){var e=o(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f("README.md","utf8");case 2:return n=e.sent,r=c.render(n),e.abrupt("return",t.send(this.createHtmlPage(r)));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),createHtmlPage:function(e){return'\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n            <title>txr - Transfer Files to Friends</title>\n\n            <style>\n              body {\n                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n              }\n\n              a {\n                color: inherit;\n              }\n\n              pre.hljs {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #f5f5f5;\n                overflow-x: scroll;\n                padding: 5px;\n              }\n\n              .container {\n                max-width: 700px;\n                margin-right: auto;\n                margin-left: auto;\n              }\n\n              .notice {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #28a745;\n                color: white;\n                padding: 15px;\n                margin: 25px 0px;\n              }\n            </style>\n          </head>\n\n          <body>\n            <div class="container">\n              <div class="notice">\n                You navigated to a txr server to transfer files easily to and\n                from other machines. Learn more below or by visiting\n                <a href="https://www.npmjs.com/package/txr">https://www.npmjs.com/package/txr</a>\n              </div>\n              '+e+"\n            </div>\n          </body>\n        </html>\n      "}}}},function(e,t){e.exports=require("es6-promisify")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={filepath:process.env.TXR_PATH||process.env["win32"==process.platform?"USERPROFILE":"HOME"],server:{port:process.env.PORT||8e3,web_conc:process.env.WEB_CONCURRENCY||1,host:process.env.TXR_HOST||"https://txr.euphoritech.com"},logger:{options:{name:process.env.APP_NAME||"txr",level:process.env.LOGGING_LEVEL||"info",stream:process.stdout}}}},function(e,t,n){n(9),e.exports=n(10)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}return r("next")})}}var i=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=r(n(11)),a=r(n(0)),s=r(n(13)),c=(0,u.default)(process.argv.slice(2)),f=i(c._,3),l=f[0],d=f[1],p=f[2];!function(){var e=o(regeneratorRuntime.mark(function e(){var t,n,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.c||c.command||l,n=c.f||c.file||c.d||c.dir||d,r=c.u||c.username||p||d,o=c.a||c.auth,i=c.h||c.host,!t||!s.default[t]){e.next=10;break}return e.next=8,s.default[t]({file:n,user:r,auth:o,host:i});case 8:e.next=11;break;case 10:a.default.error("Please enter a valid command (-c or --command).");case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()()},function(e,t){e.exports=require("minimist")},function(e,t){e.exports=require("colors")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(14)),i=r(n(19));t.default={listen:o.default,send:i.default}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}return r("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),u=r(n(2)),a=r(n(3)),s=r(n(4)),c=r(n(5)),f=r(n(17)),l=r(n(0)),d=r(n(7));t.default=function(){var e=o(regeneratorRuntime.mark(function e(t){var n,r=this,p=(t.file,t.user),h=t.auth,v=t.host;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=2;break}return e.abrupt("return",l.default.error("Make sure you pass a user (-u or --username) to listen for files that could be sent to you.\n"));case 2:(n=a.default.connect(v||d.default.server.host)).emit("regiser-listen",{user:p,auth:h}),n.on("user-taken",function(){l.default.error("The user you chose, "+p+", is already registered with the server. Please try another username."),process.exit()}),n.on("user-registered-success",function(e){l.default.success("Successfully registered name: "+e+". You are now listening for files.")}),n.on("file-permission",function(){var e=o(regeneratorRuntime.mark(function e(t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return delete t.user,e.next=3,(0,f.default)().ask("\nSomeone wants to send you a file. Are you okay receiving a file with this data: "+JSON.stringify(t)+" -- answer (yes/no): ");case 3:o=e.sent,l.default.success("You answered '"+o+"', we're letting the server and sender know now."),n.emit("file-permission-response",o);case 6:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}()),n.on("disconnect",function(){l.default.error("You were disconnected from the server."),process.exit()}),(0,s.default)(n).on("file",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};delete t.user,l.default.success("Starting to receive file with data: "+JSON.stringify(t));var n=c.default.getFileName(t.filename||"txr.file"),r=u.default.join(d.default.filepath,u.default.basename(n)),o=i.default.createWriteStream(r),a=0;e.on("data",function(e){a+=e.length,l.default.progress(".")}),e.on("error",function(e){return l.default.error("\nError reading stream: "+e.toString())}),e.on("end",function(){l.default.success("\nFinished receiving file with data: "+JSON.stringify(t)),l.default.success("Target file path: "+r)}),e.pipe(o)});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("highlight.js")},function(e,t){e.exports=require("markdown-it")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{rl:r.default.createInterface({input:process.stdin,output:process.stdout}),ask:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(r,o){t.rl.question(e,function(e){r(e),n&&t.close()})})},close:function(){this.rl.close()}}};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(18))},function(e,t){e.exports=require("readline")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(o,i){try{var u=t[o](i),a=u.value}catch(e){return void n(e)}if(!u.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}return r("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(1)),u=r(n(2)),a=r(n(6)),s=r(n(3)),c=r(n(4)),f=r(n(20)),l=r(n(5)),d=r(n(0)),p=r(n(7)),h=(0,a.default)(i.default.access),v=(0,a.default)(i.default.lstat),m=(0,a.default)(i.default.unlink),g=(0,a.default)(i.default.writeFile),x=(0,a.default)(f.default);t.default=function(){var e=o(regeneratorRuntime.mark(function e(t){var n,r,a,f,y,w,b,_,k,P,R,O,M,j,N,T,q=this,S=function(){var e=o(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!P){e.next=3;break}return e.next=3,m(k);case 3:t(),process.exit();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),E=t.file,A=t.user,F=t.host;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=E,r=A,n){e.next=4;break}return e.abrupt("return",d.default.error("Make sure you pass an absolute filepath (-f or --file) to send a file.\n"));case 4:if(r){e.next=6;break}return e.abrupt("return",d.default.error("Make sure you pass a user (-u or --username) to send a file to.\n"));case 6:return e.next=8,function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(n);case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,q,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()(n);case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return",d.default.error("We couldn't find a file or directory located in the following location:\n"+n+"\n"));case 11:return e.next=13,v(n);case 13:if(f=e.sent,y=f.isDirectory(),w=f.isFile(),b=f.size,_=void 0,k=void 0,P=void 0,!y){e.next=28;break}return d.default.success("We are zipping and sending the directory: "+n+". This may take some time depending on how large the directory is..."),e.next=22,x(n);case 22:_=e.sent,k=l.default.getFileName(n+".zip"),P=!0,b+=" (directory)",e.next=34;break;case 28:if(!w){e.next=33;break}_=n,k=n,e.next=34;break;case 33:return e.abrupt("return",d.default.error("The path specified is not a file or directory. The specified path needs to be a file or directory.\n"+n+"\n"));case 34:if(R=s.default.connect(F||p.default.server.host),O=c.default.createStream(),M=u.default.basename(k),j={filename:M,filesizebytes:b,user:r},R.emit("send-file-check-auth",j),R.on("no-user",function(e){return S(function(){return d.default.error("No user registered with username: "+e.user)})}),R.on("file-permission-granted",function(){return(0,c.default)(R).emit("upload",O,j)}),R.on("file-permission-waiting",function(){return d.default.success("Waiting for user to grant or reject receiving the file.")}),R.on("file-permission-denied",function(){return S(function(){return d.default.error("User did not grant permission to send file.")})}),R.on("file-data-hash-mismatch",function(){return S(function(){return d.default.error("We can't validate the file you're sending.")})}),R.on("finished-uploading",function(){return S(function(){return d.default.success("Your file has successfully sent to "+r+"!")})}),R.on("disconnect",function(){return S(function(){return d.default.error("You were disconnected from the server.")})}),!(_ instanceof Buffer)){e.next=49;break}return e.next=49,g(k,_);case 49:N=i.default.createReadStream(k),T=0,N.on("data",function(e){T+=e.length,d.default.progress(".")}),N.on("end",function(){return d.default.success("\nAll bytes have been read from file: "+k+".")}),N.pipe(O);case 54:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},function(e,t){e.exports=require("zip-dir")}]);