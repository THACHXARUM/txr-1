!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={filepath:process.env.TXR_PATH||process.env["win32"==process.platform?"USERPROFILE":"HOME"]||".",server:{port:process.env.PORT||8e3,web_conc:process.env.WEB_CONCURRENCY||1,host:process.env.TXR_HOST||"https://txr.euphoritech.com"},redis:{url:process.env.REDIS_URL||"redis://localhost:6379"},logger:{options:{name:process.env.APP_NAME||"txr",level:"info",stream:process.stdout}}};t.default=n},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("socket.io-client")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1)),i=n(r(14)),a=n(r(15)).default({highlight:function(e,t){if(t&&i.default.getLanguage(t))try{return`<pre class="hljs"><code>${i.default.highlight(t,e,!0).value}</code></pre>`}catch(e){}return""}}),o=s.default.promises.readFile;t.default={getFileName(e,t=Date.now()){const r=e.lastIndexOf("."),n=e.substring(r);return`${e.substring(0,r)}_${t}${n}`},expressjs:{async convertReadmeToHtml(e){const t=await o("README.md","utf8"),r=a.render(t,{});return e.send(this.createHtmlPage(r))},createHtmlPage:e=>`\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n            <title>txr - Transfer Files to Friends</title>\n\n            <style>\n              body {\n                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n              }\n\n              a {\n                color: inherit;\n              }\n\n              pre.hljs {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #f5f5f5;\n                overflow-x: scroll;\n                padding: 5px;\n              }\n\n              .container {\n                max-width: 700px;\n                margin-right: auto;\n                margin-left: auto;\n              }\n\n              .notice {\n                border-radius: 5px;\n                border: 1px solid #a0a0a0;\n                background: #28a745;\n                color: white;\n                padding: 15px;\n                margin: 25px 0px;\n              }\n            </style>\n          </head>\n\n          <body>\n            <div class="container">\n              <div class="notice">\n                You navigated to a txr server to transfer files easily to and\n                from machines/servers. Learn more below or by visiting\n                <a href="https://github.com/whatl3y/txr">https://github.com/whatl3y/txr</a>\n              </div>\n              ${e}\n            </div>\n          </body>\n        </html>\n      `}}},function(e,t){e.exports=require("socket.io-stream")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(16);const n=()=>{};t.default={success(e){this.wrapInNewlines(()=>console.log(e.green))},error(e){this.wrapInNewlines(()=>console.log(e.red))},progress(e){process.stdout.write(e)},chatMessage(e){this.wrapInNewlines(()=>console.log(e.cyan))},wrapInNewlines(e=n,t=0){const r=t-1>0?new Array(t-1).fill("\n").join(""):"";t>0&&console.log(r),e(),t>0&&console.log(r)}}},function(e,t,r){e.exports=r(8)},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(9));t.default=async function(e){return await new Promise(async(t,r)=>{const n=e.c||e.command,i=e.f||e.file||e.d||e.dir,a=e.u||e.username||e.user,o=e.t||e.target_user||e.targetUser,l=e.a||e.auth,u=e.h||e.host,c=e.l||e.logger,f=e.callback;try{await s.default({typeInterface:"library",command:n,file:i,user:a,targetUser:o,auth:l,host:u,logger:c,callback:f,reject:r,resolve:t})}catch(e){r(e)}})}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(10)),i=n(r(18));t.default=async function({typeInterface:e,command:t,file:r,user:n,targetUser:a,auth:o,host:l,logger:u,callback:c,reject:f,resolve:d}){if(!e||!i.default[e])throw new Error("We don't recognize the interface provided: "+e);{const h=i.default[e];if(!t||!s.default[t])throw new Error("We don't recognize the command provided: "+t);await s.default[t]({client:h,file:r,user:n,targetUser:a,auth:o,host:l,logger:u,callback:c,reject:f,resolve:d})}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(11)),i=n(r(12)),a=n(r(13));t.default={chat:s.default,listen:i.default,send:a.default}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(2)),i=n(r(0));t.default=async function({client:e,user:t,targetUser:r,host:n,reject:a,resolve:o}){const l=s.default.connect(n||i.default.server.host),u=e({socket:l,user:t,targetUser:r,host:n,reject:a,resolve:o});if(!t)return u.reject("Make sure you pass a user (-u or --username) to listen for files that could be sent to you.\n");if(!r)return u.reject("Make sure you pass a target user (-t or --target_user) to send chat messages to.\n");l.emit("txr-regiser-listen",{user:t});const c=u.chat;if(!c)return u.reject("The interface provided does not support the chat command.\n");const f=c.normal;Object.keys(f).forEach(e=>l.on(e,f[e].bind(c)))}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(2)),i=n(r(0)),a=r(5);t.default=async function({client:e,file:t,user:r,auth:n,host:o,callback:l,reject:u,resolve:c}){const f=s.default.connect(o||i.default.server.host),d=e({socket:f,socketStream:a,file:t,user:r,auth:n,host:o,callback:l,reject:u,resolve:c});if(!r)return d.reject("Make sure you pass a user (-u or --username) to listen for files that could be sent to you.\n");f.emit("txr-regiser-listen",{user:r,auth:n});const h=d.listen,p=h.normal,m=h.stream;Object.keys(p).forEach(e=>f.on(e,p[e].bind(h))),Object.keys(m).forEach(e=>a(f,null).on(e,m[e].bind(h)))}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1)),i=n(r(3)),a=n(r(2)),o=n(r(4)),l=n(r(6)),u=n(r(0)),c=r(5),f=r(17),d=s.default.promises.access,h=s.default.promises.lstat,p=s.default.promises.writeFile;t.default=async function({client:e,file:t,user:r,host:n,reject:m,resolve:g}){const y=a.default.connect(n||u.default.server.host),v=c.createStream(null),w=e({socket:y,socketStream:c,writeStream:v,file:t,user:r,host:n,reject:m,resolve:g}),b=t,_=r;if(!b)return w.reject("Make sure you pass an absolute filepath (-f or --file) to send a file.\n");if(!_)return w.reject("Make sure you pass a user (-u or --username) to send a file to.\n");if(!await(async e=>{try{return await d(b),!0}catch(e){return!1}})())return w.reject(`We couldn't find a file or directory located in the following location:\n${b}\n`);const x=await h(b),j=x.isDirectory(),k=x.isFile();let M,S,T,O=x.size;if(j)l.default.success(`We are zipping and sending the directory: ${b}. This may take some time depending on how large the directory is...`),M=await async function(e){return new Promise((t,r)=>{f(e,(e,n)=>{if(e)return r(e);t(n)})})}(b),S=o.default.getFileName(b+".zip"),T=!0,O+=" (directory)";else{if(!k)return w.reject(`The path specified is not a file or directory. The specified path needs to be a file or directory.\n${b}\n`);M=b,S=b}M instanceof Buffer&&await p(S,M);const P={filename:i.default.basename(S),filesizebytes:O,user:_};y.emit("txr-send-file-check-auth",P);const F=s.default.createReadStream(S),$=w.send;$.finalFilename=S,$.dataForFileToSend=P,$.deleteFileAfterSend=T;const A=$.normal,E=$.stream;Object.keys(A).forEach(e=>y.on(e,A[e].bind($))),Object.keys(E).forEach(e=>F.on(e,E[e].bind($))),F.pipe(v)}},function(e,t){e.exports=require("highlight.js")},function(e,t){e.exports=require("markdown-it")},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("zip-dir")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(19)),i=n(r(22));t.default={cli:s.default,library:i.default}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1)),i=n(r(3)),a=n(r(4)),o=n(r(20)),l=n(r(6)),u=n(r(0)),c=s.default.promises.unlink,f=e=>{l.default.error.bind(l.default)(e),process.exit()},d=process.exit;t.default=function({socket:e,socketStream:t,writeStream:r,file:n,user:h,targetUser:p,auth:m,host:g,reject:y,resolve:v}){return{reject:y=y||f,resolve:v=v||d,chat:{readline:null,async waitAndSendMessage(){this.readline&&this.readline.close(),this.readline=o.default();const t=await this.readline.ask(`[${h}]: `);if(["end","exit","quit"].includes(t)&&(l.default.success("Goodbye!"),v()),0===t.length&&this.waitAndSendMessage)return await this.waitAndSendMessage();e.emit("txr-send-chat-message",{user:h,targetUser:p,message:t}),this.waitAndSendMessage&&await this.waitAndSendMessage()},normal:{"txr-user-taken":function(){y(`The user you chose, ${h}, is already registered with the server. Please try another username.`)},"txr-destination-user-not-registered":function(e){y(`(There is no user currently registered with the username ${e}.)`)},"txr-receive-chat-message":async function({targetUser:e,message:t}){l.default.chatMessage(`[${e}]: ${t}`),this.waitAndSendMessage&&await this.waitAndSendMessage()},"txr-receive-reply":async function({user:e,replyMessage:t}){this.readline&&(this.readline.close(),this.readline=null),l.default.chatMessage(`[${e}]: ${t}`),this.waitAndSendMessage&&await this.waitAndSendMessage()},"txr-user-registered-success":async function(e){l.default.success(`Successfully registered name: ${e}. You can now send messages to ${p} below.\n`),l.default.success("(type 'exit' or 'quit' to stop sending messages)"),this.waitAndSendMessage&&await this.waitAndSendMessage()}}},listen:{readline:null,async askToReply(t){this.readline&&this.readline.close(),this.readline=o.default();const r=await this.readline.ask(`reply to ${t} - [${h}]: `);r.length>0?(e.emit("txr-reply-to-chat-message",{user:t,replyMessage:r}),l.default.success(`Thanks, your reply was sent to ${t}!`)):this.askToReply&&await this.askToReply(t)},normal:{"txr-user-taken":function(){y(`The user you chose, ${h}, is already registered with the server. Please try another username.`)},"txr-user-registered-success":function(e){l.default.success(`Successfully registered name: ${e}. You are now listening for files.`)},"txr-file-permission":async function(t){delete t.user;const r=await o.default().ask(`\nSomeone wants to send you a file. Are you okay receiving a file with this data: ${JSON.stringify(t)} -- answer (yes/no): `);l.default.success(`You answered '${r}', we're letting the server and sender know now.`),e.emit("txr-file-permission-response",r)},"txr-receive-chat-message":async function({targetUser:e,message:t}){l.default.chatMessage(`[${e}]: ${t}`),this.askToReply&&await this.askToReply(e)},disconnect:function(){y("You were disconnected from the server.")}},stream:{"txr-file":function(e,t={}){delete t.user,l.default.success("Starting to receive file with data: "+JSON.stringify(t));const r=a.default.getFileName(t.filename||"txr.file"),n=i.default.join(u.default.filepath,i.default.basename(r)),o=s.default.createWriteStream(n);let c=0;e.on("data",e=>{c+=e.length,l.default.progress(".")}),e.on("error",e=>l.default.error("\nError reading stream: "+e.toString())),e.on("end",()=>{l.default.success("\nFinished receiving file with data: "+JSON.stringify(t)),l.default.success("Target file path: "+n)}),e.pipe(o)}}},send:{bytesTracker:0,dataForFileToSend:null,deleteFileAfterSend:!1,finalFilename:null,async exitGracefully(e=(()=>{})){this.deleteFileAfterSend&&this.finalFilename&&await c(this.finalFilename),e(),v()},normal:{"txr-no-user":function(e){this.exitGracefully&&this.exitGracefully(()=>l.default.error("No user registered with username: "+e.user))},"txr-file-permission-granted":function(){t(e).emit("txr-upload",r,this.dataForFileToSend)},"txr-file-permission-waiting":function(){l.default.success("Waiting for user to grant or reject receiving the file.")},"txr-file-permission-denied":function(){this.exitGracefully&&this.exitGracefully(()=>l.default.error("User did not grant permission to send file."))},"txr-file-data-hash-mismatch":function(){this.exitGracefully&&this.exitGracefully(()=>l.default.error("We can't validate the file you're sending."))},"txr-finished-uploading":function(){this.exitGracefully&&this.exitGracefully(()=>l.default.success(`Your file has successfully sent to ${h}!`))},disconnect:function(){this.exitGracefully&&this.exitGracefully(()=>l.default.error("You were disconnected from the server."))}},stream:{data:function(e){this.bytesTracker=this.bytesTracker+e.length,l.default.progress(".")},end:function(){l.default.success(`\nAll bytes have been read from file: ${this.finalFilename}.`)}}}}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(21));t.default=function(e=process.stdin,t=process.stdout){return{rl:s.default.createInterface({input:e,output:t}),async ask(e,t=!0){return await new Promise((r,n)=>{this.rl.question(e,e=>{r(e),t&&this.close()})})},close(){this.rl.close()}}}},function(e,t){e.exports=require("readline")},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(r(1)),i=n(r(3)),a=n(r(4)),o=n(r(0)),l=()=>{};t.default=function({socket:e,socketStream:t,writeStream:r,file:n,user:u,targetUser:c,host:f,logger:d,callback:h,reject:p,resolve:m}){return d=d||{debug:l,info:l},{reject:p,resolve:m,listen:{normal:{"txr-user-taken":function(){p(`The user you chose, ${u}, is already registered with the server. Please try another username.`)},disconnect:function(){p("You were disconnected from the server.")}},stream:{"txr-file":function(e,t={}){const r="function"==typeof h?h:m,n=a.default.getFileName(t.filename||"txr.file"),l=i.default.join(o.default.filepath,i.default.basename(n)),u=s.default.createWriteStream(l);let c=0;e.on("data",e=>{c+=e.length,d.debug(".")}),e.on("error",p),e.on("end",()=>r(l)),e.pipe(u)}}},send:{bytesTracker:0,dataForFileToSend:null,finalFilename:null,normal:{"txr-no-user":function(e){p("No user registered with username: "+e.user)},"txr-file-permission-granted":function(){t(e).emit("txr-upload",r,this.dataForFileToSend)},"txr-file-permission-waiting":function(){d.info("Waiting for user to grant or reject receiving the file.")},"txr-file-permission-denied":function(){p("User did not grant permission to send file.")},"txr-file-data-hash-mismatch":function(){p("We can't validate the file you're sending.")},"txr-finished-uploading":function(){m(`Your file has successfully sent to ${u}!`)},disconnect:function(){p("You were disconnected from the server.")}},stream:{data:function(e){this.bytesTracker=this.bytesTracker+e.length,d.debug(".")},end:function(){d.info(`All bytes have been read from file: ${this.finalFilename}.`)}}}}}}]);