#!/usr/bin/env node

!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t){e.exports=require("socket.io-stream")},function(e,t){e.exports=require("bunyan")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={filepath:process.env.TXR_PATH||process.env["win32"==process.platform?"USERPROFILE":"HOME"],server:{port:process.env.PORT||8e3,web_conc:process.env.WEB_CONCURRENCY||1,host:process.env.TXR_HOST||"http://txr.herokuapp.com"},logger:{options:{name:process.env.APP_NAME||"txr",level:process.env.LOGGING_LEVEL||"info",stream:process.stdout}}}},function(e,t,n){n(4),e.exports=n(5)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}r(n(6)),r(n(7));var o=r(n(8)),i=r(n(0)),s=r(n(1)),u=r(n(9)),c=r(n(10)),a=r(n(2)),f=s.default.createLogger(a.default.logger.options),d=(0,o.default)().listen(a.default.server.port);d.on("connection",function(e){f.info("got socket: "+e.id);var t=(0,i.default)(e),n=(0,u.default)(d,e,c.default);Object.keys(n.normal).forEach(function(t){return e.on(t,n.normal[t])}),Object.keys(n.stream).forEach(function(e){return t.on(e,n.stream[e])})})},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("socket.io")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){function r(e,t,n,r){e.pipe(t),(0,i.default)(n).emit("file",t,r)}return{normal:{"regiser-listen":function(e){var r=e.auth,o=e.user;n.names[o]?(t.emit("user-taken",!0),u.error("User could not register name: "+o)):(n.names[o]=t.id,n.ids[t.id]=o,n.auth[t.id]=!!r,t.emit("user-registered-success",o),u.info("User successfully registered name: "+o))},disconnect:function(){u.info("socket disconnected: "+t.id);var e=n.ids[t.id];delete n.ids[t.id],delete n.auth[t.id],delete n.names[e]}},stream:{upload:function(o){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u.info("Received 'upload' event with data: "+JSON.stringify(s));var c=s.user,a=n.names[c],f=n.auth[a];if(c&&a){var d=e.sockets.connected[a],l=i.default.createStream();o.on("data",function(e){return u.info("Received "+e.length+" bytes of data.")}),o.on("error",function(e){return u.error("socket: "+t.id,e)}),o.on("end",function(){return u.info("Completed receiving file with data: "+JSON.stringify(s)+"!")}),l.on("end",function(){return t.emit("finished-uploading")}),f?(t.emit("file-permission-waiting"),d.on("file-permission-response",function(e){"yes"===e.toLowerCase()?r(o,l,d,s):t.emit("file-permission-denied")}),d.emit("file-permission",s)):r(o,l,d,s)}else u.error("Tried to send a file to '"+c+"' who has not registered."),t.emit("no-user",{user:c})}}}};var o=r(n(1)),i=r(n(0)),s=r(n(2)),u=o.default.createLogger(s.default.logger.options)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={names:{},ids:{},auth:{}}}]);