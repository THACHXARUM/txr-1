#!/usr/bin/env node

!function(e){function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}var t={};r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=6)}([function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e&&e.__esModule}(t(10));var n=function(){};r.default={twoLinesDifferentColors:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"blue",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"green";this.wrapInNewlines(function(){e.length>0&&console.log(e[t]),r.length>0&&console.log(r[n])})},singleLine:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.wrapInNewlines(function(){return console.log(e[r])},t)},success:function(e){this.wrapInNewlines(function(){return console.log(e.green)})},error:function(e){this.wrapInNewlines(function(){return console.log(e.red)})},wrapInNewlines:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r-1>0&&new Array(r-1).fill("\n").join("");e()}}},function(e,r){e.exports=require("fs")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("socket.io-client")},function(e,r){e.exports=require("socket.io-stream")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={filepath:process.env["win32"==process.platform?"USERPROFILE":"HOME"],server:{port:process.env.PORT||8e3,web_concurrency:process.env.WEB_CONCURRENCY||1,host:process.env.HOSTNAME||"http://localhost:8000"},logger:{options:{name:process.env.APP_NAME||"file-handoff",level:process.env.LOGGING_LEVEL||"info",stream:process.stdout}}}},function(e,r,t){t(7),e.exports=t(8)},function(e,r){e.exports=require("babel-polyfill")},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(u,o){try{var i=r[u](o),a=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}}var o=function(){function e(e,r){var t=[],n=!0,u=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){u=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(u)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=n(t(9)),a=n(t(0)),s=n(t(11)),c=(0,i.default)(process.argv.slice(2)),f=o(c._,3),l=f[0],d=f[1],p=f[2];!function(){var e=u(regeneratorRuntime.mark(function e(){var r,t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.c||c.command||l,t=c.f||c.file||d,n=c.u||c.username||p||d,!r||!s.default[r]){e.next=8;break}return e.next=6,s.default[r]({file:t,user:n});case 6:e.next=9;break;case 8:a.default.error("Please enter a valid command (-c or --command).");case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()()},function(e,r){e.exports=require("minimist")},function(e,r){e.exports=require("colors")},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=n(t(12)),o=n(t(13));r.default={listen:u.default,send:o.default}},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(u,o){try{var i=r[u](o),a=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(t(1)),i=n(t(2)),a=n(t(3)),s=n(t(4)),c=n(t(0)),f=n(t(5));r.default=function(){var e=u(regeneratorRuntime.mark(function e(r){r.file;var t,n=r.user;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",c.default.error("Make sure you pass a user (-u or --username) to listen for files that could be sent to you.\n"));case 2:(t=a.default.connect(f.default.server.host)).emit("regiser-listen",{user:n}),t.on("user-taken",function(){c.default.error("The user you chose, "+n+", is already registered with the server. Please try another username."),process.exit()}),t.on("user-registered-success",function(e){return c.default.success("Successfully registered name: "+e+". You are now listening for files.")}),(0,s.default)(t).on("file",function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.default.success("Received 'file' event with data "+JSON.stringify(r));var t=i.default.join(f.default.filepath,i.default.basename(r.filename||"file-handler-file")),n=o.default.createWriteStream(t);e.on("data",function(e){return c.default.success("Wrote "+e.length+" bytes of data.")}),e.on("error",function(e){return c.default.error("Error reading stream: "+e.toString())}),e.on("end",function(){c.default.success("Completed receiving file with data: "+JSON.stringify(r)+"!"),c.default.success("Target file path: "+t)}),e.pipe(n)});case 7:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(u,o){try{var i=r[u](o),a=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(t(1)),i=n(t(2)),a=n(t(14)),s=n(t(3)),c=n(t(4)),f=n(t(0)),l=n(t(5)),d=(0,a.default)(o.default.access),p=(0,a.default)(o.default.lstat);r.default=function(){var e=u(regeneratorRuntime.mark(function e(r){var t,n,a,v,h,m,g,y,b=this,x=r.file,w=r.user;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x,n=w,t){e.next=4;break}return e.abrupt("return",f.default.error("Make sure you pass an absolute filepath (-f or --file) to send a file.\n"));case 4:if(n){e.next=6;break}return e.abrupt("return",f.default.error("Make sure you pass a user (-u or --username) to send a file to.\n"));case 6:return e.next=8,function(){var e=u(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d(t);case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,b,[[0,6]])}));return function(r){return e.apply(this,arguments)}}()(t);case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return",f.default.error("We couldn't find a file located in the following location:\n"+t+"\n"));case 11:return e.next=13,p(t);case 13:if(v=e.sent.isFile()){e.next=16;break}return e.abrupt("return",f.default.error("The parth specified is not a file. Only files are available to send:\n"+t+"\n"));case 16:h=s.default.connect(l.default.server.host),m=c.default.createStream(),g=i.default.basename(t),(0,c.default)(h).emit("upload",m,{filename:g,user:n}),h.on("no-user",function(e){f.default.error("No user registered with username: "+e.user),process.exit()}),h.on("finished-uploading",function(){return process.exit()}),(y=o.default.createReadStream(t)).on("data",function(e){return f.default.success("Received "+e.length+" bytes of data.")}),y.on("end",function(){return f.default.success("Completed sending file!\n")}),y.pipe(m);case 26:case"end":return e.stop()}},e,this)}));return function(r){return e.apply(this,arguments)}}()},function(e,r){e.exports=require("es6-promisify")}]);